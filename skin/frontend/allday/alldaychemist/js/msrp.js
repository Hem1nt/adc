if(!window.Catalog){window.Catalog={}}Catalog.Map={helpLinks:[],active:false,addHelpLink:function(b,g,f,e,c){if(typeof b=="string"){b=$$(b)[0]}if(!b){return}var a={link:b};var h=false;if(typeof g=="string"&&g){a.title=g;h=true}if(typeof f=="string"&&f||typeof f=="object"&&f){a.price=f;h=true}if(typeof e=="string"&&e){a.msrp=e;h=true}if(!h){this.setGotoView(b,c)}else{var d=this.helpLinks.push(a)-1;Event.observe(b,"click",this.showHelp.bind(this.helpLinks[d]))}return a},setGotoView:function(a,b){$(a).stopObserving("click");a.href=b;if(window.opener){Event.observe(a,"click",function(c){setPLocation(this.href,true);Catalog.Map.hideHelp();c.stop()})}else{Event.observe(a,"click",function(c){setLocation(this.href);Catalog.Map.hideHelp();window.opener.focus();c.stop()})}},showSelects:function(){var a=document.getElementsByTagName("select");for(i=0;i<a.length;i++){a[i].style.visibility="visible"}},hideSelects:function(){var a=document.getElementsByTagName("select");for(i=0;i<a.length;i++){a[i].style.visibility="hidden"}},showHelp:function(c){var f=$("map-popup"),g=typeof document.body.style.maxHeight==="undefined";if(!f){return}var e=$$("body")[0];if(f.parentNode!=e){f.remove();e.insert(f);var n=f.select(".paypal-logo > a > img")[0];if(n){n.src=n.src}}if(this!=Catalog.Map&&Catalog.Map.active!=this.link){f.style.display="none";if(!f.offsetPosition){f.offsetPosition={left:0,top:0}}f.removeClassName("map-popup-right");f.removeClassName("map-popup-left");if(Element.getWidth(e)<c.pageX+Element.getWidth(f)){f.addClassName("map-popup-left")}else{if(c.pageX-Element.getWidth(f)<0){f.addClassName("map-popup-right")}}f.style.left=c.pageX-(Element.getWidth(f)/2)+"px";f.style.top=c.pageY+10+"px";var b=$("map-popup-heading");if(typeof this.title!="undefined"){Element.update(b,this.title);$(b).show()}else{$(b).hide()}var l=$("map-popup-msrp-box");if(typeof this.msrp!="undefined"){Element.update($("map-popup-msrp"),this.msrp);$(l).show()}else{$(l).hide()}var o=$("map-popup-price-box");if(typeof this.price!="undefined"){var j=typeof this.price=="object"?this.price.innerHTML:this.price;Element.update($("map-popup-price"),j);$(o).show()}else{$(o).hide()}var m=$("map-popup-button");if(typeof this.cartLink!="undefined"){if(typeof productAddToCartForm=="undefined"||this.notUseForm){Catalog.Map.setGotoView(m,this.cartLink);productAddToCartForm=$("product_addtocart_form_from_popup")}else{if(this.qty){productAddToCartForm.qty=this.qty}m.stopObserving("click");m.href=this.cartLink;Event.observe(m,"click",function(q){productAddToCartForm.action=this.href;productAddToCartForm.submit(this)})}productAddToCartForm.action=this.cartLink;var a=$("map-popup-product-id");a.value=this.product_id;$(m).show();$$(".additional-addtocart-box").invoke("show")}else{$(m).hide();$$(".additional-addtocart-box").invoke("hide")}var h=$("map-popup-text"),k=$("map-popup-text-what-this"),p=$("map-popup-content");if(!l.visible()&&!o.visible()&&!m.visible()){$(h).hide();$(k).show();$(k).removeClassName("map-popup-only-text");$(p).hide().setStyle({visibility:"hidden"});$("product_addtocart_form_from_popup").hide()}else{$(k).hide();$(h).show();$(h).addClassName("map-popup-only-text");$(p).show().setStyle({visibility:"visible"});$("product_addtocart_form_from_popup").show()}$(f).show();if(g){Catalog.Map.hideSelects()}var d=$("map-popup-close");if(d){$(d).stopObserving("click");Event.observe(d,"click",Catalog.Map.showHelp.bind(this));Catalog.Map.active=this.link}}else{$(f).hide();if(g){Catalog.Map.showSelects()}Catalog.Map.active=false}Event.stop(c)},hideHelp:function(){var a=$("map-popup");if(a){var b=typeof document.body.style.maxHeight==="undefined";$(a).hide();if(b){Catalog.Map.showSelects()}Catalog.Map.active=false}},bindProductForm:function(){if(("undefined"!=typeof productAddToCartForm)&&productAddToCartForm){productAddToCartFormOld=productAddToCartForm;productAddToCartForm=new VarienForm("product_addtocart_form_from_popup");productAddToCartForm.submitLight=productAddToCartFormOld.submitLight}else{if(!$("product_addtocart_form_from_popup")){return false}else{if("undefined"==typeof productAddToCartForm){productAddToCartForm=new VarienForm("product_addtocart_form_from_popup")}}}productAddToCartForm.submit=function(b,a){if(("undefined"!=typeof productAddToCartFormOld)&&productAddToCartFormOld){if(Catalog.Map.active){Catalog.Map.hideHelp()}if(productAddToCartForm.qty&&$("qty")){$("qty").value=productAddToCartForm.qty}parentResult=productAddToCartFormOld.submit();return false}if(window.opener){var g=b;new Ajax.Request(this.form.action,{parameters:{isAjax:1,method:"GET"},onSuccess:function(e){window.opener.focus();if(g&&g.href){setPLocation(g.href,true);Catalog.Map.hideHelp()}}});return}if(this.validator.validate()){var c=this.form;var d=c.action;if(a){c.action=a}if(!c.getAttribute("action")){c.action=productAddToCartForm.action}try{this.form.submit()}catch(f){this.form.action=d;throw f}this.form.action=d;if(b&&b!="undefined"){b.disabled=true}}}.bind(productAddToCartForm)}};Event.observe(window,"resize",function(a){if(Catalog.Map.active){Catalog.Map.showHelp(a)}});$(document).observe("bundle:reload-price",function(a){var d=a.memo,m=d.bundle;if(!Number(m.config.isMAPAppliedDirectly)&&!Number(m.config.isFixedPrice)){var k=false;try{for(var h in m.config.selected){if(m.config.options[h]&&m.config.options[h].selections){var b=m.config.options[h].selections;for(var f=0,c=m.config.selected[h].length;f<c;f++){var g=m.config.selected[h][f];if(Number(b[g].canApplyMAP)){k=true;break}}}if(k){break}}}catch(j){k=true}if(k){$$(".full-product-price").each(function(l){$(l).hide()});$$(".map-info").each(function(l){$(l).show()});a.noReloadPrice=true}else{$$(".full-product-price").each(function(l){$(l).show()});$$(".map-info").each(function(l){$(l).hide()})}}});