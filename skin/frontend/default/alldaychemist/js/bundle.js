if(typeof Product=="undefined"){var Product={}}Product.Bundle=Class.create();Product.Bundle.prototype={initialize:function(a){this.config=a;if(a.defaultValues){for(var d in a.defaultValues){if(this.config.options[d].isMulti){var c=new Array();for(var b=0;b<a.defaultValues[d].length;b++){c.push(a.defaultValues[d][b])}this.config.selected[d]=c}else{this.config.selected[d]=new Array(a.defaultValues[d]+"")}}}this.reloadPrice()},changeSelection:function(b){var c=b.id.split("-");if(this.config.options[c[2]].isMulti){selected=new Array();if(b.tagName=="SELECT"){for(var a=0;a<b.options.length;a++){if(b.options[a].selected&&b.options[a].value!=""){selected.push(b.options[a].value)}}}else{if(b.tagName=="INPUT"){selector=c[0]+"-"+c[1]+"-"+c[2];selections=$$("."+selector);for(var a=0;a<selections.length;a++){if(selections[a].checked&&selections[a].value!=""){selected.push(selections[a].value)}}}}this.config.selected[c[2]]=selected}else{if(b.value!=""){this.config.selected[c[2]]=new Array(b.value)}else{this.config.selected[c[2]]=new Array()}this.populateQty(c[2],b.value)}this.reloadPrice()},reloadPrice:function(){var b=0;var a=0;var g=0;for(var e in this.config.selected){if(this.config.options[e]){for(var d=0;d<this.config.selected[e].length;d++){var c=this.selectionPrice(e,this.config.selected[e][d]);b+=Number(c[0]);a+=Number(c[1]);g+=Number(c[2])}}}var f=$(document).fire("bundle:reload-price",{price:b,priceInclTax:g,dispositionPrice:a,bundle:this});if(!f.noReloadPrice){optionsPrice.specialTaxPrice="true";optionsPrice.changePrice("bundle",b);optionsPrice.changePrice("nontaxable",a);optionsPrice.changePrice("priceInclTax",g);optionsPrice.reload()}return b},selectionPrice:function(d,c){if(c==""||c=="none"){return 0}var f=null;if(this.config.options[d].selections[c].customQty==1&&!this.config.options[d].isMulti){if($("bundle-option-"+d+"-qty-input")){f=$("bundle-option-"+d+"-qty-input").value}else{f=1}}else{f=this.config.options[d].selections[c].qty}if(this.config.priceType=="0"){price=this.config.options[d].selections[c].price;tierPrice=this.config.options[d].selections[c].tierPrice;for(var b=0;b<tierPrice.length;b++){if(Number(tierPrice[b].price_qty)<=f&&Number(tierPrice[b].price)<=price){price=tierPrice[b].price}}}else{selection=this.config.options[d].selections[c];if(selection.priceType=="0"){price=selection.priceValue}else{price=(this.config.basePrice*selection.priceValue)/100}}var e=this.config.options[d].selections[c].plusDisposition+this.config.options[d].selections[c].minusDisposition;if(this.config.specialPrice){newPrice=(price*this.config.specialPrice)/100;newPrice=(Math.round(newPrice*100)/100).toString();price=Math.min(newPrice,price)}selection=this.config.options[d].selections[c];if(selection.priceInclTax!==undefined){priceInclTax=selection.priceInclTax;price=selection.priceExclTax!==undefined?selection.priceExclTax:selection.price}else{priceInclTax=price}var a=new Array(price*f,e*f,priceInclTax*f);return a},populateQty:function(b,a){if(a==""||a=="none"){this.showQtyInput(b,"0",false);return}if(this.config.options[b].selections[a].customQty==1){this.showQtyInput(b,this.config.options[b].selections[a].qty,true)}else{this.showQtyInput(b,this.config.options[b].selections[a].qty,false)}},showQtyInput:function(c,b,a){elem=$("bundle-option-"+c+"-qty-input");elem.value=b;elem.disabled=!a;if(a){elem.removeClassName("qty-disabled")}else{elem.addClassName("qty-disabled")}},changeOptionQty:function(a,b){var c=true;if(typeof(b)!="undefined"){if(b.keyCode==8||b.keyCode==46){c=false}}if(c&&(Number(a.value)==0||isNaN(Number(a.value)))){a.value=1}parts=a.id.split("-");optionId=parts[2];if(!this.config.options[optionId].isMulti){selectionId=this.config.selected[optionId][0];this.config.options[optionId].selections[selectionId].qty=a.value*1;this.reloadPrice()}},validationCallback:function(c,a){if(c==undefined||$(c)==undefined){return}var b=$(c).up("ul.options-list");if(typeof b!="undefined"){if(a=="failed"){b.removeClassName("validation-passed");b.addClassName("validation-failed")}else{b.removeClassName("validation-failed");b.addClassName("validation-passed")}}}};